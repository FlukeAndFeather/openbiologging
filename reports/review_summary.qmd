---
title: "Review Summary"
format: 
  html:
    toc: true
execute:
  echo: false
editor: visual
bibliography: references.bib
---

```{r}
#| label: setup
#| include: false

library(tidyverse)
library(treemapify)

papers <- readRDS(here::here("outputs/papers.rds"))
novel_data_devices <- readRDS(here::here("outputs/novel_data_devices.rds"))
novel_data_papers <- readRDS(here::here("outputs/novel_data_papers.rds"))
novel_data_taxa <- readRDS(here::here("outputs/novel_data_taxa.rds"))
tax_class <- readRDS(here::here("outputs/taxa_classification.rds"))

```

## When, where, how, and who

### When: year of publication

`r nrow(novel_data_papers)` / `r nrow(drop_na(papers, manuscript_type))` papers presented novel bio-logging data. The number of papers published per year is trending up (max of 12 in 2021).

```{r}
#| label: paper-years

novel_data_papers %>% 
  count(year) %>% 
  complete(year = min(year):max(year), fill = list(n = 0)) %>% 
  ggplot(aes(year, n)) +
  geom_line() +
  geom_point() +
  theme_minimal()

```

### Where: publication source

*Marine Ecology Progress Series* published the most papers of any journal, followed by *Animal Biotelemetry* and *PLOS One*. Only journals with two or more publications shown here.

```{r}
#| label: journals

novel_data_papers %>% 
  count(source) %>% 
  arrange(desc(n)) %>% 
  filter(n > 1) %>% 
  knitr::kable()
```

### How: sensors deployed

Location sensors (GPS, Argos, and depth) were deployed in the most studies. Accelerometers and temperature were the most commonly used intrinsic and environmental sensors, respectively. See [@williams2019] for definitions of location, intrinsic, and environmental sensors.

```{r}
#| label: device-types

novel_data_devices %>% 
  pivot_longer(c(ltype, itype, etype), 
               names_to = "cat", 
               values_to = "sensor") %>% 
  separate_longer_delim(sensor, ",") %>% 
  mutate(cat = factor(cat,
                      levels = c("ltype", "itype", "etype"),
                      labels = c("Location", "Intrinsic", "Environment")),
         sensor = str_trim(sensor, "both")) %>% 
  filter(sensor != "?") %>% 
  drop_na(sensor) %>% 
  count(cat, sensor) %>% 
  mutate(sensor = fct_reorder(sensor, n, .desc = TRUE)) %>% 
  ggplot(aes(sensor, n, fill = cat)) +
  geom_col() +
  scale_fill_brewer("Sensor type", palette = "Dark2") +
  theme_minimal() +
  theme(axis.text.x = element_text(hjust = 1, angle = 60))

```

### Who: taxa tracked

Mammals and birds were tracked in the most studies.

```{r}
#| label: taxa-tracked

taxa_tracked <- novel_data_papers %>% 
  left_join(novel_data_taxa, by = "id") %>% 
  left_join(tax_class, by = c("genus", "species"))

taxa_tracked %>% 
  drop_na(class, order) %>% 
  count(class, order) %>% 
  mutate(class = fct_reorder(class, n, .fun = sum, .desc = TRUE)) %>% 
  ggplot(aes(area = n, label = order, subgroup = class, fill = class)) +
  geom_treemap() +
  geom_treemap_subgroup_border() +
  geom_treemap_text(color = "white", place = "topleft", reflow = TRUE) +
  labs(fill = "Class")

taxa_tracked %>% 
  drop_na(class) %>% 
  group_by(class) %>% 
  summarize(`N papers` = n(),
            `N species` = n_distinct(species)) %>% 
  arrange(desc(`N papers`)) %>% 
  knitr::kable()

```
